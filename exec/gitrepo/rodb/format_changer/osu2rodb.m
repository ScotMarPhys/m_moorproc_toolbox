%% convert 'OSU stranger' format to RODB format%% set file namesfilename='gib.29';outname='gib29.rcm';% open filesfid1=fopen(filename,'rt');fid2=fopen(outname,'wt');% read header of input file and extract informationrline=fgetl(fid1);rline=fgetl(fid1);nhead=str2num(rline(1:6))+1;rline=fgetl(fid1);ndata=str2num(rline(1:6));rline=fgetl(fid1);rline=fgetl(fid1);exname=rline(17:length(rline));rline=fgetl(fid1);lat=str2num(rline(20:25));		% WARNING onlylon=-str2num(rline(34:40));		% valid for GIBRALTARrline=fgetl(fid1);instrdepth=str2num(rline(21:24));rline=fgetl(fid1);waterdepth=str2num(rline(19:22));rline=fgetl(fid1);rline=fgetl(fid1);ncols=nhead-10;cols=[];gcols=[];for n=1:ncols  rline=fgetl(fid1);  if findstr(rline,'hour')    cols=[cols,':hour'];    gcols=[gcols,2];  elseif findstr(rline,'day')    cols=[cols,':day'];    gcols=[gcols,1];  elseif findstr(rline,'month')    cols=[cols,':month'];    gcols=[gcols,1];  elseif findstr(rline,'year')    cols=[cols,':year'];    gcols=[gcols,3];  elseif findstr(rline,'speed')%    cols=[cols,':speed'];    gcols=[gcols,0];  elseif findstr(rline,'dir')%    cols=[cols,':dir'];    gcols=[gcols,0];  elseif findstr(rline,'U')    cols=[cols,':u'];    gcols=[gcols,1];  elseif findstr(rline,'V')    cols=[cols,':v'];    gcols=[gcols,1];  elseif findstr(rline,'temp')    cols=[cols,':t'];    gcols=[gcols,1];  elseif findstr(rline,'pressure')    cols=[cols,':p'];    gcols=[gcols,1];  elseif findstr(rline,'cond')    cols=[cols,':c'];    gcols=[gcols,1];  elseif findstr(rline,'line')%    cols=[cols,':line'];    gcols=[gcols,0];  endendcols=cols(2:length(cols));[strlat,strlon]=pos2str([lat,lon]);% write headerfprintf(fid2,['Filename       = ',filename,'\n'],1);fprintf(fid2,['Mooring        = Gibraltar? \n'],1);fprintf(fid2,['Instrument     = RCM? \n'],1);fprintf(fid2,['Latitude       = ',strlat,' \n'],1);fprintf(fid2,['Longitude      = ',strlon,' \n'],1);fprintf(fid2,['Waterdepth     = ',num2str(waterdepth),' \n'],1);fprintf(fid2,['Instrdepth     = ',num2str(instrdepth),' \n'],1);fprintf(fid2,['Columns        = ',cols,' \n'],1);% read datadata=fscanf(fid1,'%f');data=reshape(data,ncols,length(data)/ncols)';data=data(:,find(gcols>0));% reformat datagood=find(gcols==2);if ~isempty(good)  data(:,good)=data(:,good)/100;endgood=find(gcols==3);if ~isempty(good)  data(:,good)=data(:,good)+1900;end% compose output format stringnn=rodbhead(cols);wform=[];for n=1:length(nn)  if nn(n)==104    wform=[wform,'%5.2f '];  elseif nn(n)==103    wform=[wform,'%2d '];  elseif nn(n)==102    wform=[wform,'%2d '];  elseif nn(n)==101    wform=[wform,'%4d '];  elseif nn(n)==320    wform=[wform,'%6.1f '];  elseif nn(n)==321    wform=[wform,'%6.1f '];  elseif nn(n)==50    wform=[wform,'%6.3f '];  elseif nn(n)==20    wform=[wform,'%6.3f '];  elseif nn(n)==1    wform=[wform,'%6.1f '];  endend% write datafprintf(fid2,[wform,'\n'],data');% close filesfclose(fid1);fclose(fid2);