%% search RO database for profiles and existing files%% results are stored in 2 variables% rodb_data=[year,month,day,hour,min,lat,lon,maxdepth,system]% rodb_file='full path and filename'clear% systemssys_id=['ctd   ';...	'peg   ';...	'ladcp ';...	'topo  ';...	'btl   ';...	''];% build up cruise directory listrpath=rodbpath;[dummy,list1]=unix(['ls ',rpath]);cruise_id=[];while ~isempty(list1)  [t1,list1]=strtok(list1,setstr(10));  dummy=['ls ',rpath,'/',deblank(t1)];  [dummy,list2]=unix(dummy);  while ~isempty(list2)    [t2,list2]=strtok(list2,setstr(10));    dummy=['ls ',rpath,'/',deblank(t1),'/',deblank(t2)];    [dummy,list3]=unix(dummy);    while ~isempty(list3)      [t3,list3]=strtok(list3,setstr(10));      ok=0;      for n=1:size(sys_id,1)        if strcmp(t3,deblank(sys_id(n,:)))	  ok=1;        end      end      if ok==1        if isempty(cruise_id)          cruise_id=[deblank(t1),':',deblank(t2),':',deblank(t3)];        else          cruise_id=str2mat(cruise_id,...      		[deblank(t1),':',deblank(t2),':',deblank(t3)]);        end      end      if strcmp(list3,setstr(10))        break      end    end    if strcmp(list2,setstr(10))      break    end  end  if strcmp(list1,setstr(10))    break  endend	   % prepare result arraysrodb_data=nan*zeros(5000,9);rodb_file=setstr(32*ones(5000,20));count=0;% loop over cruises and systemsfor n=1:size(cruise_id,1)    m=nan;    for k=1:size(sys_id,1)      if ~isempty(findstr(cruise_id(n,:),deblank(sys_id(k,:))))        m=k;      end    end     disp(m)% loop over possible file numbers    for k=1:200% compose shortcut      fileshort=[deblank(cruise_id(n,:)),':',...		int2str(k)];      disp(fileshort)% load header informations      if isempty(findstr(cruise_id(n,:),'topo'))        [dat,tim,lat,lon,maxdep]=rodbload(fileshort,...		'date:time:latitude:longitude:max_depth');        if ~isempty(dat) & ~isempty(lat)          count=count+[1:size(dat,2)];          if isempty(maxdep)            maxdep=nan*ones(1,length(count));          end          if isempty(dat)            dat=[nan;nan;nan]*ones(1,length(count));          end          if isempty(tim)            tim=[nan;nan]*ones(1,length(count));          end          if isempty(lon)            lon=[nan]*ones(1,length(count));          end          if isempty(lat)            lat=[nan]*ones(1,length(count));          end          if length(count)==1            rodb_data(count,:)=[dat',tim',lat,lon,maxdep,m];          else            rodb_data(count,:)=[reshape(dat,3,length(count))',...		reshape(tim,2,length(count))',...		lat',lon',maxdep',m*ones(length(count),1)];          end       	  rodb_file(count,1:length(fileshort))=fileshort;          count=max(count);        end      else        [filename,sections,cruise]=rodbload(fileshort,...		'filename:section:cruise');        if ~isempty(filename) | ~isempty(sections) | ~isempty(cruise)          count=count+1;          rodb_data(count,:)=[0,nan*ones(1,7),m];       	  rodb_file(count,1:length(fileshort))=fileshort;        end       end    endend% deblank resultsgood=find(~isnan(rodb_data(:,1)));rodb_data=rodb_data(good,:);rodb_file=rodb_file(good,:);% save date of database searchrodb_date=date;save rodb_info rodb_data rodb_file rodb_date