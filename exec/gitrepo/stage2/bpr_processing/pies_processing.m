% processing of pies bottom pressure data / % -- despike% -- apply drift fitclearloc = 'v404_4';  % Verankerungsposition % -- parameters for despikingpytol        = [-.5 .5];pstddy_tol   = 6; tytol        = [-5 5];tstddy_tol   = 6; nloop       = 3;dum         = -9999;sr          = 48;  % samling/interpolation rate [per day]co          = 1/2; % cutoff    [per day]       co2         = 1/30; ssr         = 2;   % sub sampling rate  programme   = 'pies_processing.m';    if strcmp(loc,'v404_4')  load /data-so5/move_kanzow/me60_kanzow/mat_data/057_3.mat  id   =57;  time_corr = 0;  %first guess onlyelseif strcmp(loc,'v406_4')  load /data-so5/move_kanzow/me60_kanzow/mat_data/012_0.mat  id   =12;  time_corr = 0;  %first guess onlyelseif strcmp(loc,'v404_3')  load /data-so5/move_kanzow/so172_kanzow/mat_data/002_21.mat  id   =2;  time_corr = 0;  %first guess onlyelseif strcmp(loc,'v405_3')  load /data0-led/move_kanzow/so172_kanzow/mat_data/001_8.mat  id   =12;  time_corr = 0;  %first guess only  time_lim  = julian(2002,12,1,0); %%% PIES 001_8 began to drift after Nov 2002   pvalI     = find(jd<time_lim);  P         = P(pvalI);  T         = T(pvalI);    t         = t(pvalI);  jd        = jd(pvalI);elseif strcmp(loc,'v406_3')  load /data-so5/move_kanzow/so172_kanzow/mat_data/012_4.mat  id   =12;  time_corr = 0;  %first guess onlyelseif strcmp(loc,'v404_2')%  load /data11/atalante02/mooring/v404_2/pies/012_3.mat   load /data0-led/move/atalante02/mooring/v404_2/pies/012_3_PTinversion.mat  id = 12;   time_corr =  0; % time offset [days] compared to UTCelseif strcmp(loc,'v405_2')   load /data11/atalante02/mooring/v405_2/pies/001_7.mat  id = 1;  time_corr =  -0.9844; % time offset [days] compared to UTCelseif strcmp(loc,'v404_1')   load /data8/kanzow/so153_kanzow/mat_data/001_3.mat  id = 1;  time_corr =  0; % time offset [days] compared to UTCelseif strcmp(loc,'v405_1')   load /data8/kanzow/so153_kanzow/mat_data/009_6.mat  id = 9;  time_corr =  0; % time offset [days] compared to UTCelseif strcmp(loc,'v406_1')   load /data8/kanzow/so153_kanzow/mat_data/002_6.mat  id = 2;  time_corr =  0; % time offset [days] compared to UTCend  time_basep  = 24:length(jd)-200;jd          = jd(time_basep)- time_corr;P           = P(time_basep)*10;  % P [bar] --> [dbar]T           = T(time_basep);[pd,dx,ndx] = ddspike(P,pytol,pstddy_tol,[nloop],'y',dum);[td,dx,ndx] = ddspike(T,tytol,tstddy_tol,[nloop],'y',dum);valI        = find(pd ~= dum);jd_grid     = jd(valI(1)):1/sr:jd(valI(length(valI)));pr_int      = interp1(jd(valI),pd(valI),jd_grid); % pressurepr_filt     = auto_filt(pr_int,sr,co);pr_filt2    = auto_filt(pr_int,sr,co2,'low',4); valI        = find(td ~= dum);%ii          = find(diff(jd(valI))>0);t_int       = interp1(jd(valI),td(valI),jd_grid);  % temperature[exfit_coef,pr_exfit]  = exp_lin_fit2(jd_grid,pr_int,[1 1 1 1]);linfit_coef            = polyfit(jd_grid,pr_int,1);pr_linfit              = polyval(linfit_coef,jd_grid); eval(['save ',loc,'_pies.mat pr_int pr_filt  pr_filt2 pr_exfit pr_linfit exfit_coef linfit_coef t_int jd_grid programme']) % ---- spectral estimate of pressure [spec,coh95,fs] = spectrum_tm(pr_int-pr_exfit,5,length(pr_int)*2,5,10,sr);% ---- graphics ----------------------------  figure(1) hold off plot(jd_grid-jd(1),pr_filt,'b') hold on %% plot(jd_grid-jd(1),pf2,'r') plot(jd_grid-jd(1),pr_exfit,'g--') plot(jd_grid-jd(1),pr_linfit,'m--')grid onylim([min(pr_filt) max(pr_filt)])xlabel('time [days]')ylabel('pressure [dbar]')title(['mooring ',loc,'   sensor id ',sprintf('%3.3d',id)])legend('pressure (2 day low-pass)','exp.-lin. fit','lin. fit',2)eval(['print -dpsc pies_processing',loc,'P.psc']) figure(2) hold off plot(jd_grid-jd(1),t_int,'b')xlabel('time [days]')ylabel('temperature [ \circ C]')title(['mooring ',loc,'   sensor id ',sprintf('%3.3d',id)])grid oneval(['print -dpsc pies_processing',loc,'T.psc'])figure(3)loglog(1./fs,spec)title(['mooring ',loc,'   sensor id ',sprintf('%3.3d',id)])ylabel(['spectral density'])xlabel('period')