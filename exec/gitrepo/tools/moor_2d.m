% interpolate time series of mooring salinity and temperature (+anomalies)% onto regular grid and display contour plots%% T,S matrices created here are used in moor_geo.m  % % kanzow Feb,2001% kanzow 7.5.2001 data path changed% tuningmoor = 'v406_4';  % 'V405_1', 'V406_1' , 'V404_1';'v404_2',....moors = 'M3';     %   'M2'  ,   'M3'   ,  'M1';%data_dir = '/data-hel/move/so153_kanzow/mat_data/'data_dir = '/data-so5/move_kanzow/me60_kanzow/mat_data/';top_sensor =1;  % if strcmp(moor,'v404_3') | strcmp(moor,'v406_3') | strcmp(moor,'v404_4') % 10m MicroCAT nicht berŸcksichtigen  top_sensor =2;endeval(['load ',data_dir,moor,'_TC.mat'])cin_depth = cin_depth(top_sensor:end,:);%keyboardTT =TT(top_sensor:end,:);CC =CC(top_sensor:end,:);p = 20 : 25: 5500;s_grid = [34.82:0.01:35.02];th_grid = [1.2:.2:5.6];sa_grid = [-.032:0.003:.031];tha_grid = [-.21:.02:.21];siga_grid =  [-0.033:0.003:0.03];ref_year  = 2001;xlm       = [10 380];% graphics output (set figX = 'y' to create desired picture)fig1 = 'n';  % salinity fig2 = 'n';  % pot. temp.fig3 = 'y';  % sal. anomaly/ pot. temp. anomalyfig5 = 'n';  % pot. temp. anomalyfig6 = 'n';  %  salinity anomalyfig7 = 'y';  % pot. temp. anomly, salinity anomaly, pot. density anomaly % approx. watermass depthwm404 = z2p([1100 1900 2300 3200 4400],16);wm405 = z2p([1100 1950 2450 3300 4600],16);wm406 = z2p([1050 1850 2300 3050 4500],16);if strcmp('V404_1',moor) |strcmp('v404_2',moor)     wm = wm404;elseif strcmp('V405_1',moor) |strcmp('v405_2',moor)      wm = wm405;elseif strcmp('V406_1',moor)  |strcmp('v406_2',moor)      wm = wm406;end% 1. C,T,P --> SSS = salin78(cin_depth,TT,CC,42.9140,0);SSS = [];TTT = [];for i = 1 : size(SS,2),   si = find(~isnan(SS(:,i)));   ti = find(~isnan(TT(:,i)));   SSS = [SSS interp1(cin_depth(si,i),SS(si,i),p)'];   TTT = [TTT interp1(cin_depth(ti,i),TT(ti,i),p)'];end%%TH  = theta(p'*ones(1,size(TTT,2)),TTT,SSS); % pot. temp.%%SIG = sigma(p'*ones(1,size(TTT,2)),TTT,SSS,0); % pot. density  TH =[];SIG =[];% --- colormapcmap  = jet(200);cmap  = cmap(40:200,1:3); % only used for pot. temperature % --- anomalies ------sm   = meanmiss(SSS')';thm  = meanmiss(TTT')';sigm = meanmiss(SIG')'; sa   = SSS - sm*ones(1,size(SSS,2));tha  = TTT  - thm*ones(1,size(TTT,2));%siga = SIG - sigm*ones(1,size(SIG,2));		siga = [];% --- Graphics -------day = jd_grid -julian(ref_year,1,1,0);ld  = length(day); % --- water mass ---------------------- %%wm = [wm;wm];%%ccc= [day(1)*ones(1,5);day(ld)*ones(1,5)];% saveeval(['save ',data_dir,moor,'_moor2d.mat',' TTT SSS SIG TH sa tha siga p jd_grid'])% ------------------- graphics -------return% ---- Salinityif fig1 == 'y'figure(1)clfhold offcolormap(jet(length(s_grid)-1));day = jd_grid -julian(2000,1,1,0);[c,h]=contourf(day,p,SSS,[s_grid]);    map_direct(h,s_grid,length(s_grid)-1)set(h,'LineWidth',.1)hold onplot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])caxis([min(s_grid) max(s_grid)])cb1 = colorbar;set(cb1,'YTick',1:length(s_grid),'YTicklabel',s_grid)yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl=title(['salinity at ',moors]);set(tl,'Fontsize',12)set(gca,'ydir' ,'reverse')set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')eval(['print -depsc ',moor,'_S.epsc'])eval(['print -dpsc ',moor,'_S.psc'])end % figure 1% ----------% --- pot. temperatureif fig2 == 'y'figure(2)clfhold off[c,h] = contourf(day,p,TH,[th_grid]);map_direct(h,th_grid,length(th_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold onplot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])%colormap(cmap);cm2=jet(length(th_grid)+2);colormap(cm2(4:length(cm2),:)) caxis([min(th_grid) max(th_grid)])cb2 = colorbar;set(cb2,'YTick',1:length(th_grid),'YTicklabel',th_grid)yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl =title(['pot. temperature at ',moors]);set(tl,'Fontsize',12)set(gca,'YLim',[min(p) max(p)])set(gca,'XLim',[xlm])set(gca,'Layer','Top')set(gca,'Box','on')eval(['print -depsc ',moor,'_TH.epsc'])eval(['print -dpsc ',moor,'_TH.psc'])end%--- salinity/pot. temp. anomalyif fig3 =='y'figure(3) clfsubplot(2,1,1)hold off[c,h]=contourf(day,p,sa,[sa_grid]);map_direct(h,sa_grid,length(sa_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold on%plot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])colormap(jet(length(sa_grid)-1)); caxis([min(sa_grid) max(sa_grid)])cb3 =colorbar;set(cb3,'YTick',1:2:length(sa_grid),'YTicklabel',sa_grid(1:2:length(sa_grid)))yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl=title(['salinity anomaly at ',moors]);set(tl,'Fontsize',12)set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')subplot(2,1,2)hold off[c,h] = contourf(day,p,tha,[tha_grid]);map_direct(h,tha_grid,length(tha_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold on%plot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])colormap(jet(length(tha_grid)-1));caxis([min(tha_grid) max(tha_grid)])cb4 = colorbar;set(cb4,'YTick',1:2:length(tha_grid),'YTicklabel',tha_grid(1:2:length(tha_grid)))yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl =title(['pot. temperature anomaly at ',moors]);set(tl,'Fontsize',12)set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')orient portraiteval(['print -depsc ',moor,'_SA_THA.epsc'])eval(['print -dpsc ',moor,'_SA_THA.psc'])end % figure 3% ---  pot. temperature anomalyif fig5 == 'y' figure(5) hold offsubplot(2,1,2)hold off[c,h] = contourf(day,p,tha,[tha_grid]);map_direct(h,tha_grid,length(tha_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold onplot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])colormap(jet(length(tha_grid)-1));caxis([min(tha_grid) max(tha_grid)])cb4 = colorbar;set(cb4,'YTick',1:2:length(tha_grid),'YTicklabel',tha_grid(1:2:length(tha_grid)))yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl =title(['pot. temperature anomaly at ',moors]);set(tl,'Fontsize',12)set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')orient portraiteval(['print -dpsc ',moor,'_THA_sub.psc'])end % figure 5if fig6 == 'y'figure(6)  % salinity anomalyclfsubplot(2,1,2)hold off[c,h]=contourf(day,p,sa,[sa_grid]);map_direct(h,sa_grid,length(sa_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold on%plot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])colormap(jet(length(sa_grid)-1)); caxis([min(sa_grid) max(sa_grid)])cb3 =colorbar;set(cb3,'YTick',1:2:length(sa_grid),'YTicklabel',sa_grid(1:2:length(sa_grid)))yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl=title(['salinity anomaly at ',moors])set(tl,'Fontsize',12)set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')eval(['print -dpsc ',moor,'_SA_sub.psc'])end % pot. temp./ salinity / anomaly/ pot density  anomalyif fig7 == 'y'figure(7) clfsubplot(3,1,1)hold off[c,h]=contourf(day,p,siga,[siga_grid]);map_direct(h,siga_grid,length(siga_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold on%plot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])colormap(jet(length(siga_grid)-1)); caxis([min(siga_grid) max(siga_grid)])cb3 =colorbar;set(cb3,'YTick',1:2:length(siga_grid),'YTicklabel',siga_grid(1:2:length(siga_grid)))yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl=title(['pot. density anomaly at ',moors]);set(tl,'Fontsize',12)set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')subplot(3,1,2)hold off[c,h] = contourf(day,p,tha,[tha_grid]);map_direct(h,tha_grid,length(tha_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold on%plot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])colormap(jet(length(tha_grid)-1));caxis([min(tha_grid) max(tha_grid)])cb4 = colorbar;set(cb4,'YTick',1:2:length(tha_grid),'YTicklabel',tha_grid(1:2:length(tha_grid)))yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl =title(['pot. temperature anomaly at ',moors]);set(tl,'Fontsize',12)set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')subplot(3,1,3)hold off[c,h]=contourf(day,p,sa,[sa_grid]);map_direct(h,sa_grid,length(sa_grid)-1)set(h,'LineWidth',.1)set(gca,'Ydir','reverse')hold on%plot(day,cin_depth,'-m','LineWidth',1)plot(ccc,wm,'w--','Linewidth',2)dayaxis(day,2000,[1])colormap(jet(length(sa_grid)-1)); caxis([min(sa_grid) max(sa_grid)])cb3 =colorbar;set(cb3,'YTick',1:2:length(sa_grid),'YTicklabel',sa_grid(1:2:length(sa_grid)))yl= ylabel('pressure [dbar]');set(yl,'FontSize',12)tl=title(['salinity anomaly at ',moors])set(tl,'Fontsize',12)set(gca,'XLim',[xlm])set(gca,'YLim',[min(p) max(p)])set(gca,'Layer','Top')set(gca,'Box','on')orient talleval(['print -dpsc ',moor,'_THA_SA_SIGA.psc'])end